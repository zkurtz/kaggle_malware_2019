import pandas as pd
import pickle

def first_N(df, N):
    N = min(N, df.shape[0])
    return df.iloc[:N]

def which_top_features(model, N=25):
    ''' Identify the most-important features based on model(s) previously fitted

    :param model: string (pickled model filepath) or a fitted model; all models involved are required to have
        an `importance` method that reveals features in descending order of importance by 'gain'
    :param N: Number of top features to select
    :return: list of feature names
    '''
    if isinstance(model, str):
        model_list = pickle.load(open(model, "rb"))
        if not isinstance(model_list, list):
            model_list = [model_list]
        imps = pd.concat([m.importance() for m in model_list])
        imps = imps.groupby('feature').sum().sort_values('gain', ascending=False)
        return first_N(imps, N).index.tolist()

    else:
        return first_N(model.importance(), N).feature.tolist()
