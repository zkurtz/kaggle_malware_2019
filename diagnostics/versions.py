from distutils.version import LooseVersion
import pandas as pd
import pdb

from zpylib import datatools
from zpylib import data_path as dp

cols = datatools.identify_version_features() # + ['MachineIdentifier'] # see assertion below ...

print("Read version features in train.csv")
vftrain = pd.read_csv(dp("raw/train.csv"), usecols=cols + ['HasDetections'])
print("Read version features in test.csv")
vftest = pd.read_csv(dp("raw/test.csv"), usecols=cols)
#assert vftrain.shape[0] + vftest.shape[0] == pd.concat([vftrain.MachineIdentifier, vftest.MachineIdentifier]).nunique()
df = pd.concat([vftrain, vftest], ignore_index=True, sort=True)

def build_version_index(v):
    values = df[v].unique().tolist()
    values.sort(key=LooseVersion)
    return pd.DataFrame({v: values, 'idx': range(len(values))})

vmeta = {v: build_version_index(v) for v in cols}

def order_correlation(v):
    print(v)
    lkp = vmeta[v]
    x = vftrain[[v]]
    nx = x.merge(lkp, how='left')
    pdb.set_trace()

order_correlation(cols[0])